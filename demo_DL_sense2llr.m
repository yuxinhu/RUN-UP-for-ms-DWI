addpath(genpath(pwd))

% This demo reloads the loaded kspace data (in tr*.mat), 
% does shot-LLR reconstruction and save it into another folder.

% cd /bmrNAS/people/yuxinh/bart/bart-0.4.03/

addpath(genpath('/bmrNAS/people/yuxinh/MS_DWI6'))
addpath(genpath('/bmrNAS/people/yuxinh/MS_DWI_reorg/DL_prep/'))

filepaths = {'/bmrNAS/people/yuxinh/DTI_20170816/16Aug17_Ex12278_Ser3/SENSE_gcc8/'; ...
    '/bmrNAS/people/yuxinh/DTI_20170816/16Aug17_Ex12278_Ser3/SENSE_gcc8_nex2/'; ...
    '/bmrNAS/people/yuxinh/DTI_20180513/13May18_Ex3787_Ser3/SENSE_gcc8/';...
    '/bmrNAS/people/yuxinh/DTI_20180513/13May18_Ex3787_Ser4/SENSE_gcc8/';...
    '/bmrNAS/people/yuxinh/DTI_20180513/13May18_Ex3787_Ser9/SENSE_gcc8/';...
    '/bmrNAS/people/yuxinh/DTI_20180513/13May18_Ex3787_Ser10/SENSE_gcc8/';...
    '/bmrNAS/people/yuxinh/DTI_20180603/03Jun18_Ex3966_Ser4/SENSE_gcc8/';...
    '/bmrNAS/people/yuxinh/DTI_20180603/03Jun18_Ex3966_Ser5/SENSE_gcc8/';...
    '/bmrNAS/people/yuxinh/DTI_20180609/09Jun18_Ex4010_Ser4/SENSE_gcc8/';...
    '/bmrNAS/people/yuxinh/DTI_20180609/09Jun18_Ex4010_Ser5/SENSE_gcc8/';...
    }

savepaths = {'/bmrNAS/people/yuxinh/DTI_20170816/16Aug17_Ex12278_Ser3/llr_0002_corr/'; ...
    '/bmrNAS/people/yuxinh/DTI_20170816/16Aug17_Ex12278_Ser3/llr_0002_corr_nex2/'; ...
    '/bmrNAS/people/yuxinh/DTI_20180513/13May18_Ex3787_Ser3/llr_0002_corr/';...
    '/bmrNAS/people/yuxinh/DTI_20180513/13May18_Ex3787_Ser4/llr_0002_corr/';...
    '/bmrNAS/people/yuxinh/DTI_20180513/13May18_Ex3787_Ser9/llr_0002_corr/';...
    '/bmrNAS/people/yuxinh/DTI_20180513/13May18_Ex3787_Ser10/llr_0002_corr/';...
    '/bmrNAS/people/yuxinh/DTI_20180603/03Jun18_Ex3966_Ser4/llr_0002_corr/';...
    '/bmrNAS/people/yuxinh/DTI_20180603/03Jun18_Ex3966_Ser5/llr_0002_corr/';...
    '/bmrNAS/people/yuxinh/DTI_20180609/09Jun18_Ex4010_Ser4/llr_0002_corr/';...
    '/bmrNAS/people/yuxinh/DTI_20180609/09Jun18_Ex4010_Ser5/llr_0002_corr/';...
    }

for k = 1 : length(filepaths)
filepath = filepaths{k};
savepath = savepaths{k};
mkdir(savepath)
filenames = dir(filepath);

for i = 1 : length(filenames)
    cname = filenames(i).name;
    if (length(cname) > 2 && strcmp(cname(1:2), 'tr'))
        load([filepath, cname])
        im_ini = fast_llr(ktemp_cc, sens);
        p.reconmethod = 'LLR';
        save([savepath, cname],'ktemp_cc','sens','im_ini','p')
    end
end
end
